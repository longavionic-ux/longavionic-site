<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CATS Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, Helvetica, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    h2 { color: #38bdf8; margin-top: 0; }
    .user { color: #94a3b8; margin-bottom: 10px; }
    .chat-box {
      height: 320px;
      overflow-y: auto;
      border: 1px solid #1e293b;
      border-radius: 10px;
      padding: 10px;
      background: #020617;
      margin-bottom: 10px;
    }
    .msg { margin-bottom: 6px; font-size: 14px; }
    .msg b { color: #22c55e; }
    textarea {
      width: 100%;
      height: 60px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 6px;
      padding: 8px;
    }
    button {
      margin-top: 6px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #2563eb;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2 id="title">CATS Chat</h2>
<div class="user" id="userInfo"></div>

<div class="chat-box" id="chat"></div>

<textarea id="input" placeholder="Type message..."></textarea>
<button onclick="send()">Send</button>

<script>
  // ===== 1️⃣ 当前登录用户 =====
  const user = sessionStorage.getItem("memberUser") || "Guest";
  document.getElementById("userInfo").textContent = "Logged in as: " + user;

  // ===== 2️⃣ 读取群名（来自 URL）=====
  const params = new URLSearchParams(window.location.search);
  const group = params.get("group") || "general";

  // 标题显示当前群
  document.getElementById("title").textContent =
    "CATS Chat · " + group.toUpperCase();

  // ===== 3️⃣ 每个群一个 storage key（关键改动）=====
  const chat = document.getElementById("chat");
  const key = "cats_chat_" + group;

  function load() {
    chat.innerHTML = localStorage.getItem(key) || "";
    chat.scrollTop = chat.scrollHeight;
  }

  function send() {
    const input = document.getElementById("input");
    if (!input.value.trim()) return;

    const msg = `<div class="msg"><b>${user}:</b> ${input.value}</div>`;
    chat.innerHTML += msg;
    localStorage.setItem(key, chat.innerHTML);

    input.value = "";
    chat.scrollTop = chat.scrollHeight;
  }

  load();
</script>

</body>
</html>
